<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analysis Results - Triage AI — Contract Risk Intelligence</title>
    <meta name="description" content="Automated contract risk triage for NDAs and MSAs using deterministic rules and AI-assisted synthesis.">
    <link rel="icon" type="image/png" sizes="32x32" href="/static/branding/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/static/branding/favicon-16.png">
    <!-- TODO: Add apple-touch-icon.png to /static/branding/ -->
    <link rel="apple-touch-icon" href="/static/branding/apple-touch-icon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --primary-orange: #FF7A18;
            --primary-orange-dark: #F2541B;
            --navy: #0F172A;
            --bg-soft: #F8FAFC;
            --card-border: #E5E7EB;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--bg-soft);
            letter-spacing: -0.01em;
        }
        
        /* Fade-in animation */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        /* Logo blending - remove white background using multiply blend mode */
        .logo-container {
            display: inline-block;
            background: var(--bg-soft);
            border-radius: 20px;
            padding: 12px 16px;
            position: relative;
            /* Create isolation context for blend mode */
            isolation: isolate;
        }
        
        .logo-blended {
            display: block;
            /* Multiply blend mode: white (1.0) * light-gray (0.97) = light-gray (matches background) */
            /* Orange colors get darker but remain visible */
            mix-blend-mode: multiply;
            /* Slight adjustment to maintain orange vibrancy */
            filter: brightness(1.02) contrast(1.05);
        }
        
        /* Premium card - blended borders */
        .premium-card {
            background: #FFFFFF;
            border: 1px solid rgba(229, 231, 235, 0.5);
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.06);
        }
        
        /* Risk badge styling */
        .risk-badge-high {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05));
            border-left: 4px solid #DC2626;
        }
        
        .risk-badge-medium {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.1), rgba(217, 119, 6, 0.05));
            border-left: 4px solid #D97706;
        }
        
        .risk-badge-low {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(22, 163, 74, 0.05));
            border-left: 4px solid #16A34A;
        }
        
        /* Issue card with left border */
        .issue-card {
            border-left: 4px solid;
            transition: all 0.2s ease;
        }
        
        .issue-card:hover {
            transform: translateX(4px);
        }
        
        .issue-card-high {
            border-left-color: #DC2626;
            background: rgba(239, 68, 68, 0.02);
        }
        
        .issue-card-medium {
            border-left-color: #D97706;
            background: rgba(245, 158, 11, 0.02);
        }
        
        .issue-card-low {
            border-left-color: #3B82F6;
            background: rgba(59, 130, 246, 0.02);
        }
        
        /* Back link styling */
        .back-link {
            color: var(--primary-orange);
            transition: all 0.2s ease;
        }
        
        .back-link:hover {
            color: var(--primary-orange-dark);
            transform: translateX(-2px);
        }
        
        /* Statistics number */
        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1;
        }
        
        /* Primary button with gradient */
        .btn-primary {
            background: linear-gradient(90deg, #FF7A18, #F2541B);
            color: white;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(255, 122, 24, 0.25);
        }
        
        .btn-primary:hover {
            box-shadow: 0 4px 16px rgba(255, 122, 24, 0.35);
            transform: translateY(-1px);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <!-- Logo Header -->
        <div class="flex justify-center mb-8 fade-in">
            <a href="/" class="logo-container transition-transform hover:scale-105">
                <img src="/static/branding/triage-logo-primary.png" alt="Triage AI logo" class="h-20 sm:h-24 w-auto logo-blended" />
            </a>
        </div>

        <!-- Header -->
        <div class="mb-8 fade-in">
            <a href="/" class="back-link text-sm font-semibold mb-4 inline-flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
                Back to Upload
            </a>
            <h1 class="text-4xl sm:text-5xl font-extrabold text-[#0F172A] mb-2 tracking-tight">Analysis Results</h1>
            <p class="text-gray-600 mb-4">Contract: <span class="font-semibold text-[#0F172A]">{{ filename }}</span></p>
            <a href="/download-pdf?token={{ token }}" class="btn-primary inline-flex items-center justify-center gap-2 py-3 px-6 rounded-lg font-semibold focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#FF7A18] transition-all">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                </svg>
                Download PDF Report
            </a>
        </div>

        <!-- Overall Risk Badge -->
        <div class="mb-8 fade-in">
            {% if overall_risk == "high" %}
            <div class="risk-badge-high rounded-xl p-6 premium-card">
                <div class="flex items-center mb-2">
                    <svg class="h-7 w-7 text-red-600 mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-2xl font-bold text-red-900">High Risk Indicators Detected</span>
                </div>
                <p class="text-red-800 leading-relaxed">This contract contains high-risk indicators that may require careful review and negotiation.</p>
            </div>
            {% elif overall_risk == "medium" %}
            <div class="risk-badge-medium rounded-xl p-6 premium-card">
                <div class="flex items-center mb-2">
                    <svg class="h-7 w-7 text-amber-600 mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-2xl font-bold text-amber-900">Medium Risk Indicators Detected</span>
                </div>
                <p class="text-amber-800 leading-relaxed">This contract contains medium-risk indicators that may warrant review.</p>
            </div>
            {% else %}
            <div class="risk-badge-low rounded-xl p-6 premium-card">
                <div class="flex items-center mb-2">
                    <svg class="h-7 w-7 text-green-600 mr-3" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-2xl font-bold text-green-900">Low Risk Indicators</span>
                </div>
                <p class="text-green-800 leading-relaxed">Few risk indicators detected. Standard review recommended.</p>
            </div>
            {% endif %}
        </div>

        <!-- Executive Summary -->
        <div class="premium-card p-6 sm:p-8 mb-8 fade-in">
            <h2 class="text-2xl font-bold text-[#0F172A] mb-6">Executive Summary</h2>
            <ul class="space-y-4">
                {% for bullet in summary_bullets %}
                <li class="flex items-start">
                    <svg class="h-5 w-5 text-[#FF7A18] mr-3 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-gray-700 leading-relaxed">{{ bullet }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>

        <!-- Top Issues -->
        {% if top_issues %}
        <div class="premium-card p-6 sm:p-8 mb-8 fade-in">
            <h2 class="text-2xl font-bold text-[#0F172A] mb-6">Detected Risk Indicators</h2>
            <div class="space-y-6">
                {% for issue in top_issues %}
                <div class="issue-card {% if issue.severity == 'high' %}issue-card-high{% elif issue.severity == 'medium' %}issue-card-medium{% else %}issue-card-low{% endif %} pl-6 pr-4 py-4 rounded-lg">
                    <div class="flex items-center mb-3 flex-wrap gap-2">
                        <h3 class="text-lg font-semibold text-[#0F172A]">{{ issue.title }}</h3>
                        <span class="px-3 py-1 text-xs font-semibold rounded-full {% if issue.severity == 'high' %}bg-red-100 text-red-800{% elif issue.severity == 'medium' %}bg-amber-100 text-amber-800{% else %}bg-blue-100 text-blue-800{% endif %}">
                            {{ issue.severity|upper }}
                        </span>
                    </div>
                    {% if issue.clause_number %}
                    <div class="mb-3">
                        <span class="text-xs font-semibold text-gray-600 bg-gray-100 px-2.5 py-1 rounded-md">
                            Clause: {{ issue.clause_number }}
                        </span>
                    </div>
                    {% endif %}
                    <div class="space-y-3 text-gray-700">
                        {% if issue.matched_keywords %}
                        <div>
                            <p class="font-semibold text-sm text-gray-600 mb-1">Why This Was Flagged:</p>
                            <p class="text-sm">
                                <span class="font-mono text-xs bg-gray-100 px-2.5 py-1 rounded-md">
                                    Matched keywords: {{ issue.matched_keywords|join(", ") }}
                                </span>
                            </p>
                        </div>
                        {% endif %}
                        <div>
                            <p class="font-semibold text-sm text-gray-600 mb-1">Why This May Matter:</p>
                            <p class="leading-relaxed">{{ issue.why_it_matters }}</p>
                        </div>
                        <div>
                            <p class="font-semibold text-sm text-gray-600 mb-1">Commonly Negotiated:</p>
                            <p class="leading-relaxed">{{ issue.negotiation_consideration }}</p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Possible Missing Sections -->
        {% if possible_missing_sections %}
        <div class="premium-card p-6 sm:p-8 mb-8 fade-in">
            <h2 class="text-2xl font-bold text-[#0F172A] mb-4">Possible Missing Sections</h2>
            <p class="text-gray-600 mb-5 text-sm leading-relaxed">These sections are commonly included in commercial contracts and may be worth considering:</p>
            <ul class="grid grid-cols-1 md:grid-cols-2 gap-3">
                {% for section in possible_missing_sections %}
                <li class="flex items-start">
                    <svg class="h-5 w-5 text-gray-400 mr-2 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
                    </svg>
                    <span class="text-gray-700 leading-relaxed">{{ section }}</span>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- Statistics -->
        <div class="premium-card p-6 sm:p-8 mb-8 fade-in">
            <h2 class="text-2xl font-bold text-[#0F172A] mb-6">Analysis Statistics</h2>
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-6">
                <div class="text-center p-4 bg-gray-50 rounded-lg">
                    <div class="stat-number text-[#0F172A] mb-2">{{ findings_count }}</div>
                    <div class="text-sm font-medium text-gray-600">Total Findings</div>
                </div>
                <div class="text-center p-4 bg-red-50 rounded-lg">
                    <div class="stat-number text-red-600 mb-2">{{ rule_counts.get('high', 0) }}</div>
                    <div class="text-sm font-medium text-gray-600">High Risk</div>
                </div>
                <div class="text-center p-4 bg-amber-50 rounded-lg">
                    <div class="stat-number text-amber-600 mb-2">{{ rule_counts.get('medium', 0) }}</div>
                    <div class="text-sm font-medium text-gray-600">Medium Risk</div>
                </div>
            </div>
        </div>

        <!-- How It Works Section -->
        <div class="premium-card p-6 sm:p-8 mb-8 fade-in">
            <h2 class="text-xl font-bold text-[#0F172A] mb-4">How This Analysis Works</h2>
            <div class="space-y-4">
                <div class="flex items-start">
                    <div class="flex-shrink-0 w-8 h-8 rounded-full bg-[#FF7A18] bg-opacity-10 flex items-center justify-center mr-3 mt-0.5">
                        <span class="text-[#FF7A18] font-bold text-sm">1</span>
                    </div>
                    <div>
                        <h3 class="font-semibold text-[#0F172A] mb-1">Deterministic Engine Flags Patterns</h3>
                        <p class="text-gray-600 text-sm leading-relaxed">Our rule engine detected exact clause patterns using regex and proximity matching. Every finding above includes matched excerpts for full transparency.</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <div class="flex-shrink-0 w-8 h-8 rounded-full bg-[#FF7A18] bg-opacity-10 flex items-center justify-center mr-3 mt-0.5">
                        <span class="text-[#FF7A18] font-bold text-sm">2</span>
                    </div>
                    <div>
                        <h3 class="font-semibold text-[#0F172A] mb-1">LLM Explains Implications</h3>
                        <p class="text-gray-600 text-sm leading-relaxed">AI explained why detected patterns may matter and suggested negotiation levers. The LLM never invented risks—it only explained what the deterministic engine found.</p>
                    </div>
                </div>
                <div class="flex items-start">
                    <div class="flex-shrink-0 w-8 h-8 rounded-full bg-[#FF7A18] bg-opacity-10 flex items-center justify-center mr-3 mt-0.5">
                        <span class="text-[#FF7A18] font-bold text-sm">3</span>
                    </div>
                    <div>
                        <h3 class="font-semibold text-[#0F172A] mb-1">Triage Report for Review</h3>
                        <p class="text-gray-600 text-sm leading-relaxed">This report highlights risk indicators, matched excerpts, and suggested negotiation points. Review with qualified legal counsel before signing.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Why This Is Reliable Section -->
        <div class="premium-card p-6 sm:p-8 mb-8 fade-in">
            <h2 class="text-xl font-bold text-[#0F172A] mb-4">Why This Analysis Is Reliable</h2>
            <ul class="space-y-3 text-gray-700">
                <li class="flex items-start">
                    <svg class="h-5 w-5 text-[#FF7A18] mr-3 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span class="leading-relaxed"><strong class="text-[#0F172A]">Deterministic first-pass</strong> prevents hallucinations about clause presence. All risk detection is rule-based and auditable.</span>
                </li>
                <li class="flex items-start">
                    <svg class="h-5 w-5 text-[#FF7A18] mr-3 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span class="leading-relaxed"><strong class="text-[#0F172A]">Matched excerpts shown</strong> for every finding above, so you can verify exactly what triggered each rule.</span>
                </li>
                <li class="flex items-start">
                    <svg class="h-5 w-5 text-[#FF7A18] mr-3 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                    </svg>
                    <span class="leading-relaxed"><strong class="text-[#0F172A]">Version-controlled rules</strong> (Rule Engine Version {{ rule_engine_version }}) ensure consistent, reproducible analysis.</span>
                </li>
            </ul>
        </div>

        <!-- Legal Disclaimer -->
        <div class="bg-amber-50 border border-amber-200/60 rounded-xl p-6 mb-8 fade-in">
            <div class="flex">
                <svg class="h-6 w-6 text-amber-600 mr-3 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                </svg>
                <div>
                    <h3 class="text-lg font-bold text-amber-900 mb-2">Legal Disclaimer</h3>
                    <p class="text-amber-800 font-semibold mb-2 leading-relaxed">
                        This tool provides automated risk triage, not legal advice.
                    </p>
                    <p class="text-amber-700 text-sm leading-relaxed">
                        The analysis provided is for informational purposes only and does not constitute legal advice. 
                        This tool may indicate potential risk areas but does not determine legality, enforceability, or safety. 
                        Always consult with qualified legal counsel before signing any contract. 
                        The absence of detected risks does not guarantee a contract is safe to sign.
                    </p>
                </div>
            </div>
        </div>

        <!-- Negative Guarantees -->
        <div class="premium-card p-6 sm:p-8 mb-8 fade-in">
            <h2 class="text-xl font-bold text-[#0F172A] mb-4">What This Tool Does NOT Do</h2>
            <ul class="space-y-3 text-gray-700">
                <li class="flex items-start">
                    <svg class="h-5 w-5 text-gray-400 mr-3 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                    </svg>
                    <span class="leading-relaxed">Does not determine enforceability of contract terms</span>
                </li>
                <li class="flex items-start">
                    <svg class="h-5 w-5 text-gray-400 mr-3 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                    </svg>
                    <span class="leading-relaxed">Does not identify jurisdiction-specific legality</span>
                </li>
                <li class="flex items-start">
                    <svg class="h-5 w-5 text-gray-400 mr-3 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                    </svg>
                    <span class="leading-relaxed">Does not replace legal counsel or provide legal advice</span>
                </li>
                <li class="flex items-start">
                    <svg class="h-5 w-5 text-gray-400 mr-3 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                    </svg>
                    <span class="leading-relaxed">Does not declare terms "safe to sign" or "illegal"</span>
                </li>
            </ul>
        </div>

        <!-- Footer -->
        <footer class="mt-16 pt-8 border-t border-gray-200/50 fade-in">
            <div class="text-center text-gray-500 text-sm space-y-1">
                <p class="font-medium">© {{ current_year }} Triage AI — Contract Risk Intelligence</p>
                <p class="text-xs">Automated contract risk triage. Not legal advice.</p>
                <p class="text-xs mt-1">Rule Engine Version {{ rule_engine_version }}</p>
            </div>
        </footer>
    </div>
</body>
</html>
